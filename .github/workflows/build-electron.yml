name: Build Meftah FinLit App

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ§© Checkout repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'npm'

      - name: ðŸ“¦ Install global build tools
        run: |
          npm install -g npm@latest
          npm install -g electron electron-builder

      - name: ðŸ§° Install dependencies
        run: |
          if [ -d "frontend" ]; then
            cd frontend
            npm install
            npm run build || echo "âš ï¸ Frontend build skipped (no scripts)"
            cd ..
          fi
          npm install

      - name: ðŸ—ï¸ Configure electron-builder
        run: |
          echo '{
            "appId": "com.meftah.finlit",
            "productName": "Ù…ÙØªØ§Ø­ | Ø¢Ù…ÙˆØ²Ø´ Ø³ÙˆØ§Ø¯ Ù…Ø§Ù„ÛŒ",
            "directories": {
              "output": "dist"
            },
            "files": [
              "**/*",
              "!node_modules/*/{CHANGELOG.md,README.md,README,readme.md,readme}",
              "!**/node_modules/*/{test,__tests__,tests,powered-test,example,examples}"
            ],
            "win": {
              "target": ["nsis"],
              "icon": "Ù…ÙØªØ§Ø­ - Ø¨Ø¯ÙˆÙ† Ø²Ù…ÛŒÙ†Ù‡.png",
              "publisherName": "Meftah Education"
            },
            "nsis": {
              "oneClick": false,
              "allowToChangeInstallationDirectory": true,
              "createDesktopShortcut": true,
              "createStartMenuShortcut": true,
              "shortcutName": "Ù…ÙØªØ§Ø­"
            },
            "mac": {
              "target": ["dmg"],
              "icon": "Ù…ÙØªØ§Ø­ - Ø¨Ø¯ÙˆÙ† Ø²Ù…ÛŒÙ†Ù‡.png"
            },
            "linux": {
              "target": ["AppImage"],
              "icon": "Ù…ÙØªØ§Ø­ - Ø¨Ø¯ÙˆÙ† Ø²Ù…ÛŒÙ†Ù‡.png"
            }
          }' > electron-builder.json

      - name: ðŸš€ Build Electron App
        run: |
          npx electron-builder --config electron-builder.json || true

      - name: ðŸ“¤ Upload Installers
        uses: actions/upload-artifact@v4
        with:
          name: Meftah-FinLit-Installers
          path: dist/
